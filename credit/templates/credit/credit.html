{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ö—Ä–µ–¥–∏—Ç–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: Inter, Roboto, Arial, sans-serif; }
    body { background:#f6f7fb; color:#222; line-height:1.4; }
    .header {
      display:flex; justify-content:space-between; align-items:center;
      padding:18px 24px; background:#fff; border-bottom:1px solid #e6e9ef;
      box-shadow: 0 1px 0 rgba(0,0,0,0.02);
    }
    .logo { font-weight:700; color:#0b66ff; font-size:20px; letter-spacing:0.4px; }
    .header .profile a { text-decoration:none; color:#0b66ff; font-weight:600; }
    :root { font-family: system-ui, -apple-system, Arial, sans-serif; }
    body { margin: 0; background: #f6f7fb; }
    .wrap { max-width: 720px; margin: 48px auto; padding: 24px; background: #fff; border-radius: 16px; box-shadow: 0 6px 24px rgba(0,0,0,.06); }
    h1 { margin: 0 0 16px; font-size: 22px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .field { display: flex; flex-direction: column; gap: 6px; }
    label { font-size: 14px; color: #333; }
    input, select { padding: 10px 12px; border: 1px solid #e3e5ea; border-radius: 10px; font-size: 14px; }
    .actions { margin-top: 16px; display: flex; gap: 10px; }
    button { padding: 10px 14px; border: 0; border-radius: 10px; cursor: pointer; font-weight: 600; }
    .btn-primary { background: #4f46e5; color: #fff; }
    .btn-ghost { background: #f1f1f6; }
    .msg { margin-top: 16px; padding: 12px; border-radius: 10px; background: #f1f5ff; color: #1f3366; }
    .results { margin-top: 20px; padding: 14px; border: 1px dashed #d9def0; border-radius: 10px; background: #fafbff; }
    .results h2 { margin: 0 0 8px; font-size: 16px; }
    .muted { color: #6b7280; font-size: 13px; }
    @media (max-width: 640px){ .row { grid-template-columns: 1fr; } }
    .logo a {
      text-decoration: none; /* —É–±–∏—Ä–∞–µ—Ç –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ */
      color: inherit;        /* –Ω–∞—Å–ª–µ–¥—É–µ—Ç —Ü–≤–µ—Ç –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è */
      font-weight: bold;     /* –æ—Å—Ç–∞–≤–ª—è–µ–º –∂–∏—Ä–Ω—ã–º, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ */
    }
  </style>
</head>
<body>
  <!-- üîπ –ë–ª–æ–∫ —é–∑–µ—Ä–∞ –∏ logout -->
  <header class="header">
    <div class="logo">
      <a href="{% url 'home' %}">TEST FINTECH</a>
    </div>
    <div class="profile">
      {% if user.is_authenticated %}
        <span>{{ user.username }}</span>
        &nbsp; | &nbsp;
        <a href="{% url 'logout' %}">–í—ã–π—Ç–∏</a>
      {% else %}
        <a href="{% url 'login' %}">–í–æ–π—Ç–∏</a>
      {% endif %}
    </div>
  </header>

  <div class="wrap">
    <h1>–ö—Ä–µ–¥–∏—Ç–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h1>
    <p class="muted">–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç–∞–≤–∫—É –∏ —Å—Ä–æ–∫ –≤ –º–µ—Å—è—Ü–∞—Ö</p>

    <form method="post" action="{% url 'credit' %}">
      {% csrf_token %}

      <div class="row">
        <div class="field">
          <label for="amount">–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞</label>
          <input type="number" id="amount" name="amount" min="0" step="0.01" placeholder="–ù–∞–ø—Ä. 1000000" required>
        </div>

        <div class="field">
          <label>–¢–µ–∫—É—â–∞—è —Å—Ç–∞–≤–∫–∞, % –≥–æ–¥–æ–≤—ã—Ö</label>
          <div style="padding:10px 12px; background:#f9fafb; border:1px solid #e3e5ea; border-radius:10px;">
            {{ rate }} %
          </div>
          <input type="hidden" id="rate" name="rate" value="{{ rate }}">
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="months">–°—Ä–æ–∫, –º–µ—Å—è—Ü–µ–≤</label>
          <input type="number" id="months" name="months" min="1" step="1" placeholder="–ù–∞–ø—Ä. 24" required>
        </div>

        <div class="field">
          <label for="type">–¢–∏–ø –ø–ª–∞—Ç–µ–∂–∞</label>
          <select id="type" name="type">
            <option value="annuity" selected>–ê–Ω–Ω—É–∏—Ç–µ—Ç–Ω—ã–π</option>
            <!-- <option value="diff">–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</option> -->
          </select>
        </div>
      </div>

      <div class="actions">
        <button type="submit" name='action' value='calculate' class="btn-primary">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
        <button type="reset"  class="btn-ghost">–°–±—Ä–æ—Å–∏—Ç—å</button>
      </div>
    </form>

    {% if error %}
      <div class="msg">{{ error }}</div>
    {% endif %}

    {% if result %}
      <div class="results">
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
        <div>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂: <strong>{{ result.monthly_payment }}</strong></div>
        <div>–ü–µ—Ä–µ–ø–ª–∞—Ç–∞: <strong>{{ result.total_interest }}</strong></div>
        <div>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ: <strong>{{ result.total_payment }}</strong></div>

        <!-- üëá –∫–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å -->
        <form method="post" action="{% url 'credit' %}">
          {% csrf_token %}
          <input type="hidden" name="amount" value="{{ amount }}">
          <input type="hidden" name="rate" value="16.5">
          <input type="hidden" name="months" value="{{ months }}">
          <input type="hidden" name="type" value="annuity">
          <button type="submit" name="action" value="save" class="btn-primary">–ü–æ–ª—É—á–∏—Ç—å</button>
        </form>
      </div>
    {% endif %}
  </div>
</body>
</html>